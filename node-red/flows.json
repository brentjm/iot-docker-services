[{"id":"e14533de.48e02","type":"tab","label":"PostgreSQL","disabled":false,"info":""},{"id":"72214d68.df13c4","type":"tab","label":"influxdb","disabled":false,"info":""},{"id":"8cd5a632.6457e8","type":"tab","label":"QCM","disabled":false,"info":""},{"id":"f1615fd3.1f7d8","type":"postgresdb","z":"","hostname":"postgres","port":"5432","db":"mydatabase","ssl":false},{"id":"b56336c6.4f8bf8","type":"influxdb","z":"","hostname":"influxdb","port":"8086","protocol":"http","database":"mydatabase","name":"","usetls":false,"tls":""},{"id":"5fc328c2.4bf0f8","type":"mqtt-broker","z":"","name":"xeon","broker":"10.131.72.83","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"3fa7a1c.973105e","type":"ui_group","z":"","name":"Controls","tab":"b80bcdc8.ad564","order":1,"disp":true,"width":"6","collapse":false},{"id":"b80bcdc8.ad564","type":"ui_tab","z":"","name":"QCM","icon":"dashboard","disabled":false,"hidden":false},{"id":"69aa1fb5.e84e6","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"780abad0.e5b324","type":"inject","z":"e14533de.48e02","name":"data trigger","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":277.0000305175781,"y":379.00000858306885,"wires":[["c1d1ca7a.783e08"]]},{"id":"21fb2d51.ff1ec2","type":"function","z":"e14533de.48e02","name":"prepare query","func":"msg.payload = [\n    {\n        query: 'begin',\n    },\n    {\n        query: 'insert into mytable (timestamp, username, experiment, value) values ($1, $2, $3, $4)',\n        params: [msg.payload[\"timestamp\"], msg.payload[\"username\"], msg.payload[\"experiment\"], msg.payload[\"value\"]],\n    },\n    {\n        query: 'select * from mytable',\n        output: true,\n    },\n    {\n        query: 'commit',\n    },\n];\n\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":380,"wires":[["aaf10a7.b2a88f8"]]},{"id":"aaf10a7.b2a88f8","type":"postgres","z":"e14533de.48e02","postgresdb":"f1615fd3.1f7d8","name":"mydatabase","output":true,"outputs":1,"x":970,"y":380,"wires":[["eb62e24a.56bad"]]},{"id":"c1d1ca7a.783e08","type":"function","z":"e14533de.48e02","name":"create data point","func":"msg.payload = {\n    \"timestamp\": Math.floor(Date.now()/1000),\n    \"username\": \"Brent Maranzano\",\n    \"experiment\": \"test\",\n    \"value\": Math.floor(Math.random()*1000+10000)\n};\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":380,"wires":[["21fb2d51.ff1ec2"]]},{"id":"738c1b6a.287a74","type":"inject","z":"72214d68.df13c4","name":"data trigger","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":290,"y":180,"wires":[["e0eb084c.27a208"]]},{"id":"e0eb084c.27a208","type":"function","z":"72214d68.df13c4","name":"create data","func":"msg.payload = {\n    \"username\": \"Brent Maranzano\",\n    \"experiment\": \"test\",\n    \"value\": Math.floor(Math.random()*1000+10000)\n};\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":180,"wires":[["616115e4.ab3d7c"]]},{"id":"616115e4.ab3d7c","type":"influxdb out","z":"72214d68.df13c4","influxdb":"b56336c6.4f8bf8","name":"mydatabase","measurement":"random","precision":"","retentionPolicy":"","x":830,"y":180,"wires":[]},{"id":"eb62e24a.56bad","type":"debug","z":"e14533de.48e02","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1170,"y":380,"wires":[]},{"id":"a28f7633.5aa8e8","type":"mqtt out","z":"8cd5a632.6457e8","name":"","topic":"qcm/in","qos":"","retain":"","broker":"5fc328c2.4bf0f8","x":710,"y":100,"wires":[]},{"id":"a1721178.4bddb","type":"mqtt in","z":"8cd5a632.6457e8","name":"","topic":"qcm/out","qos":"2","datatype":"auto","broker":"5fc328c2.4bf0f8","x":870,"y":100,"wires":[["7afc793a.a91f18"]]},{"id":"98425fe7.773f4","type":"ui_button","z":"8cd5a632.6457e8","name":"start","group":"3fa7a1c.973105e","order":0,"width":0,"height":0,"passthru":true,"label":"start","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"command\": \"start\"}","payloadType":"json","topic":"/qcm/in","x":290,"y":280,"wires":[["3e5eeea6.dda6d2"]]},{"id":"fc0b915e.00ad5","type":"inject","z":"8cd5a632.6457e8","name":"start","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":280,"wires":[["98425fe7.773f4"]]},{"id":"62d2cd9b.949004","type":"ui_button","z":"8cd5a632.6457e8","name":"stop","group":"3fa7a1c.973105e","order":0,"width":0,"height":0,"passthru":true,"label":"stop","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"command\": \"stop\"}","payloadType":"json","topic":"/qcm/in","x":290,"y":320,"wires":[["3e5eeea6.dda6d2"]]},{"id":"2579d428.edfd1c","type":"inject","z":"8cd5a632.6457e8","name":"stop","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":320,"wires":[["62d2cd9b.949004"]]},{"id":"fc4e5177.ce87e","type":"function","z":"8cd5a632.6457e8","name":"format","func":"msg.payload = Number(msg.payload)\nreturn msg;","outputs":1,"noerr":0,"x":1070,"y":300,"wires":[[]]},{"id":"8a5cc764.27b2e8","type":"inject","z":"8cd5a632.6457e8","name":"check credentials","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":680,"wires":[["5e8099a.a365e68"]]},{"id":"6978847e.e842cc","type":"ui_text_input","z":"8cd5a632.6457e8","name":"user name","label":"user name","tooltip":"Enter user name as it will be in tagged in the database.","group":"3fa7a1c.973105e","order":3,"width":0,"height":0,"passthru":true,"mode":"text","delay":300,"topic":"userName","x":90,"y":480,"wires":[["580e9845.c92c08"]]},{"id":"848dc21a.c8199","type":"ui_text_input","z":"8cd5a632.6457e8","name":"password","label":"password","tooltip":"Enter a password that will lock the instrument.","group":"3fa7a1c.973105e","order":3,"width":0,"height":0,"passthru":true,"mode":"password","delay":300,"topic":"password","x":100,"y":520,"wires":[["580e9845.c92c08"]]},{"id":"580e9845.c92c08","type":"function","z":"8cd5a632.6457e8","name":"set credentials","func":"switch (msg.topic) {\n    case \"userName\":\n        userName = msg.payload || \"Brent Maranzano\";\n        flow.set(\"userName\", msg.payload);\n        break;\n    case \"password\":\n        password = msg.payload || \"BigLongPassword\";\n        flow.set(\"password\", msg.payload);\n        break;\n}","outputs":1,"noerr":0,"x":280,"y":500,"wires":[[]]},{"id":"3e5eeea6.dda6d2","type":"function","z":"8cd5a632.6457e8","name":"add credentials","func":"msg.payload[\"userName\"] = flow.get(\"userName\");\nmsg.payload[\"password\"] = flow.get(\"password\");\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":300,"wires":[["240216e0.13c43a"]]},{"id":"5e8099a.a365e68","type":"ui_button","z":"8cd5a632.6457e8","name":"login","group":"3fa7a1c.973105e","order":4,"width":0,"height":0,"passthru":true,"label":"login","tooltip":"Click to set credentials","color":"","bgcolor":"","icon":"","payload":"test","payloadType":"str","topic":"userName","x":290,"y":680,"wires":[["3c90dc38.552734"]]},{"id":"3c90dc38.552734","type":"function","z":"8cd5a632.6457e8","name":"send credentials","func":"msg.payload = {\n    \"command\": \"login\",\n    \"value\": {\n        \"userName\": flow.get(\"userName\"),\n        \"password\": flow.get(\"password\")\n    }\n};\n\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":680,"wires":[["76669a2.2ace764"]]},{"id":"7a786b64.d63154","type":"comment","z":"8cd5a632.6457e8","name":"send login credentials","info":"send credentials","x":340,"y":640,"wires":[]},{"id":"7860c8c3.465e98","type":"comment","z":"8cd5a632.6457e8","name":"set credentials","info":"","x":110,"y":440,"wires":[]},{"id":"a528dd13.5b3d8","type":"comment","z":"8cd5a632.6457e8","name":"QCM","info":"","x":710,"y":60,"wires":[]},{"id":"c77a6d76.b2856","type":"comment","z":"8cd5a632.6457e8","name":"send commands","info":"","x":300,"y":240,"wires":[]},{"id":"65799938.2134f8","type":"link in","z":"8cd5a632.6457e8","name":"to QCM controller","links":["240216e0.13c43a","aef90c39.e438a","76669a2.2ace764"],"x":595,"y":100,"wires":[["a28f7633.5aa8e8"]]},{"id":"7afc793a.a91f18","type":"link out","z":"8cd5a632.6457e8","name":"from QCM controller","links":["788bba83.8c7ae4"],"x":1000,"y":100,"wires":[]},{"id":"240216e0.13c43a","type":"link out","z":"8cd5a632.6457e8","name":"from commands","links":["65799938.2134f8"],"x":635,"y":300,"wires":[]},{"id":"788bba83.8c7ae4","type":"link in","z":"8cd5a632.6457e8","name":"to format response","links":["7afc793a.a91f18"],"x":955,"y":300,"wires":[["fc4e5177.ce87e"]]},{"id":"456340aa.9c6f7","type":"comment","z":"8cd5a632.6457e8","name":"format response","info":"","x":1020,"y":240,"wires":[]},{"id":"76669a2.2ace764","type":"link out","z":"8cd5a632.6457e8","name":"set credentials","links":["65799938.2134f8"],"x":635,"y":680,"wires":[]}]